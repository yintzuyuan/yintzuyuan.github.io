<!DOCTYPE html>
<html lang="{{ locale or 'zh-TW' }}" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ title }} - TzuYuan Yin</title>

  <!-- SEO Meta Tags -->
  <meta name="description" content="{{ description or '字體設計師 × 開發者 - TzuYuan Yin 殷慈遠' }}">
  <meta name="author" content="TzuYuan Yin">

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://erikyin.net{{ page.url }}">
  <meta property="og:title" content="{{ title }} - TzuYuan Yin">
  <meta property="og:description" content="{{ description or '字體設計師 × 開發者 - TzuYuan Yin 殷慈遠' }}">
  <meta property="og:image" content="https://erikyin.net/assets/og-image.jpg">

  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="https://erikyin.net{{ page.url }}">
  <meta property="twitter:title" content="{{ title }} - TzuYuan Yin">
  <meta property="twitter:description" content="{{ description or '字體設計師 × 開發者 - TzuYuan Yin 殷慈遠' }}">
  <meta property="twitter:image" content="https://erikyin.net/assets/og-image.jpg">

  <!-- hreflang SEO -->
  <link rel="alternate" hreflang="{{ lang or 'zh' }}" href="https://erikyin.net{{ page.url }}" />
  <link rel="alternate" hreflang="{{ 'en' if lang == 'zh' else 'zh' }}" href="https://erikyin.net{{ page.url | alt_lang_url }}" />

  <!-- PWA -->
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#000000">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="Erik Yin">

  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-touch-icon.png">

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@300;400;700&family=IBM+Plex+Mono:wght@400;700&family=Noto+Sans+TC:wght@100..900&display=swap" rel="stylesheet">

  <!-- 內聯極簡 CSS -->
  <style>{% include "critical.css" %}</style>

  <!-- 延遲載入完整 CSS -->
  <link rel="preload" href="/assets/style.css" as="style" onload="this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="/assets/style.css"></noscript>

  <!-- 主題初始化 -->
  <script>
    const theme = localStorage.getItem('theme') || 'light';
    document.documentElement.setAttribute('data-theme', theme);
  </script>
</head>
<body>
  <header>
    <nav>
      <button class="nav-toggle" aria-label="{{ languages[lang].ui.nav.home or '選單' }}">☰</button>
      <div class="nav-links">
        <a href="{{ '/' | locale_url }}"{% if page.url == ('/' | locale_url) %} aria-current="page"{% endif %}>{{ languages[lang].ui.nav.home or '首頁' }}</a>
        <a href="{{ '/works/' | locale_url }}"{% if page.url.startsWith('/works/') or page.url.startsWith('/en/works/') %} aria-current="page"{% endif %}>{{ languages[lang].ui.nav.works or '作品' }}</a>
        <a href="{{ '/about/' | locale_url }}"{% if page.url.startsWith('/about/') or page.url.startsWith('/en/about/') %} aria-current="page"{% endif %}>{{ languages[lang].ui.nav.about or '關於' }}</a>
        <a href="{{ '/contact/' | locale_url }}"{% if page.url.startsWith('/contact/') or page.url.startsWith('/en/contact/') %} aria-current="page"{% endif %}>{{ languages[lang].ui.nav.contact or '聯繫' }}</a>
      </div>
      <div style="float:right; display:flex; gap:0.5rem; align-items:center;">
        <a href="{{ page.url | alt_lang_url }}" class="lang-switcher" lang="{{ 'en' if lang == 'zh' else 'zh' }}" aria-label="{{ '切換語言' if lang == 'zh' else 'Switch Language' }}">
          {{ 'EN' if lang == 'zh' else '中文' }}
        </a>
        <button data-theme-toggle aria-label="{{ languages[lang].ui.theme.toggle or '切換主題' }}" style="background:none; border:1px solid var(--border); color:var(--text); padding:0.5rem; cursor:pointer; border-radius:4px; line-height:0;">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="4" />
            <path d="M12 2v2" />
            <path d="M12 20v2" />
            <path d="m4.93 4.93 1.41 1.41" />
            <path d="m17.66 17.66 1.41 1.41" />
            <path d="M2 12h2" />
            <path d="M20 12h2" />
            <path d="m6.34 17.66-1.41 1.41" />
            <path d="m19.07 4.93-1.41 1.41" />
          </svg>
        </button>
      </div>
    </nav>
  </header>

  <main>
    {{ content | safe }}
  </main>

  <!-- 回到頂部按鈕 -->
  <button id="back-to-top" aria-label="{{ languages[lang].ui.footer.backToTop or '回到頂部' }}" style="position:fixed;bottom:2rem;right:2rem;width:3rem;height:3rem;background:var(--text);color:var(--bg);border:none;border-radius:50%;font-size:1.5rem;cursor:pointer;opacity:0;visibility:hidden;z-index:99;">↑</button>

  <footer>
    <p class="lang-info">
      {{ languages[lang].ui.footer.availableIn or '此頁面也有其他語言版本：' }}
      <a href="{{ page.url | alt_lang_url }}" lang="{{ 'en' if lang == 'zh' else 'zh' }}">{{ languages['en' if lang == 'zh' else 'zh'].name }}</a>
    </p>
    <p>© 2025 TzuYuan Yin · 殷慈遠</p>
    <nav class="legal-links">
      <a href="{{ '/privacy/' | locale_url }}">{{ languages[lang].ui.footer.privacy or ('Privacy Policy' if lang == 'en' else '隱私權政策') }}</a>
      <a href="{{ '/terms/' | locale_url }}">{{ languages[lang].ui.footer.terms or ('Terms of Service' if lang == 'en' else '服務條款') }}</a>
    </nav>
  </footer>

  <!-- 極簡主題切換 -->
  <script>
    const btn = document.querySelector('[data-theme-toggle]');
    const sunIcon = '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>';
    const moonIcon = '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401"/></svg>';

    btn.addEventListener('click', () => {
      const current = document.documentElement.getAttribute('data-theme');
      const next = current === 'dark' ? 'light' : 'dark';
      document.documentElement.setAttribute('data-theme', next);
      localStorage.setItem('theme', next);
      btn.innerHTML = next === 'dark' ? moonIcon : sunIcon;
    });

    // 初始化按鈕圖示
    btn.innerHTML = localStorage.getItem('theme') === 'dark' ? moonIcon : sunIcon;

    // 導航欄收合
    document.querySelector('.nav-toggle')?.addEventListener('click', e =>
      e.target.nextElementSibling.classList.toggle('show')
    );

    // 回到頂部按鈕
    const backToTop = document.getElementById('back-to-top');
    if (backToTop) {
      window.addEventListener('scroll', () => {
        if (window.scrollY > window.innerHeight) {
          backToTop.style.opacity = '1';
          backToTop.style.visibility = 'visible';
        } else {
          backToTop.style.opacity = '0';
          backToTop.style.visibility = 'hidden';
        }
      });

      backToTop.addEventListener('click', () => {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });
    }
  </script>

  <!-- 載入主要 JavaScript -->
  <script src="/assets/script.js" defer></script>
</body>
</html>
